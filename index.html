<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Turtle Graphics to SVG</title>
<style type="text/css" media="screen">
  #editor { 
    position: absolute;
    top: 0;
    left: 0;
    bottom: 40px;
    width: 500px;
  }

  #commands {
    position: absolute;
    left: 0;
    bottom: 0;
    width: 480px;
    height: 40px;

    text-align: right;
    font-size: 20px;
  }
    button {
      font-size: 20px;
    }

  #svgContainer {
    position: absolute;
    top: 0;
    left: 500px;
    bottom: 0;
    right: 0;
    overflow: auto; 
  }

  #help {
    display: none;

    position: absolute;
    top: 10px;
    right: 10px;
    bottom: 10px;
    left: 510px;

    background-color: rgba(238, 246, 108, 0.95);
    border-radius: 10px;
    padding: 10px;
    z-index: 99;

    overflow: auto;
  }

</style>
</head>
<body>

<div id="editor">// Press [?] for help

moveForward(100);
turnLeft(1/4);
moveForward(100);
turnLeft(1/4);
moveForward(100);
</div>

<div id="commands">
  <button id="export">Export</button>
  <button id="apply" disabled="true">Apply</button>
  <input id="auto" type="checkbox" checked="true" disabled="true">auto</input>
  <!-- <button disabled="true">Export</button> -->
  <button id="show-help">?</button>
</div>

<div id="svgContainer">
  <svg id="svgOutput" xmlns="http://www.w3.org/2000/svg" version="1.1" width="500" height="500">
    <path id="turtle" d="M 0 0 " stroke="black" fill="none" vector-effect="non-scaling-stroke" />
  </svg>
</div>

<div id="help">
<pre>Source: <a href="https://github.com/forresto/turtle-svg">https://github.com/forresto/turtle-svg</a>
   __   ___   ___________    ________  _____  ________   ____
  / /  / _ | / __/ __/ _ \  /_  __/ / / / _ \/_  __/ /  / __/
 / /__/ __ |_\ \/ _// , _/   / / / /_/ / , _/ / / / /__/ _/  
/____/_/ |_/___/___/_/|_|   /_/  \____/_/|_| /_/ /____/___/  

Welcome to the JS turtle graphics -> SVG generator. 
This will generate an SVG file with one &lt;path&gt; element.
The turtle starts in the middle facing down.
Angles: 0 is down, 1/4 is right, 1/2 is up, 3/4 is left

// Relative commands
turnRight(angle);      // Shortcut r()
turnLeft(angle);       // l()
moveForward(distance); // f()

// Absolute commands
turnTo(angle);         // t()
moveTo(x, y);          // m()

// Pen (laser, blade) commands
penUp();               // u()
penDown();             // d()

// Angles for turn commands are 0.0 to 1.0
turnRight(1/4);        // Turn right 90ยบ
turnLeft(1/360);       // Turn left 1ยบ

// Functions and commands are JS:
var drawRegular = function(sideCount, sideLength) {
  for (var i=0; i&lt;sideCount; i++){
    moveForward(sideLength);
    turnRight(1/sideCount);
  }
};
drawRegular(5, 20);

// Draw a square:
moveForward(100);
turnLeft(1/4);
moveForward(100);
turnLeft(1/4);
moveForward(100);
turnLeft(1/4);
moveForward(100);

// Draw a recursive space-filling curve:
var segmentLength = 10;
function unit(iteration) {
  if (iteration > 0) {
    unit(iteration - 1);
    turnRight(0.25);
    unit(iteration - 1);
    moveForward(segmentLength);
    unit(iteration - 1);
    turnRight(0.25);
    unit(iteration - 1);
  }
}
turnTo(3/8);
unit(5);

</pre></div>

<script src="http://d1n0x3qji82z53.cloudfront.net/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
window.onload = function(){

  var editor = ace.edit("editor");
  editor.setTheme("ace/theme/monokai");
  editor.getSession().setMode("ace/mode/javascript");
  var session = editor.getSession();

  var applyButton = document.getElementById("apply");
  var autoCheck = document.getElementById("auto");
  var helpButton = document.getElementById("show-help");
  var exportButton = document.getElementById("export");
  var help = document.getElementById("help");
  var svg = document.getElementById("svgOutput");
  var path = svg.getElementById("turtle");

  var changeTimeout;
  var testCodeStart;
  var testCodeWorking = true;
  var testingCode;

  var worker;
  var workerBusy = false;

  var setupWorker = function(){
    worker = new Worker('turtle-svg-worker.js');
    worker.onmessage = function(e) {
      if (e.data === ""){
        applyButton.innerHTML = "JS error... restart?";
        applyButton.disabled = false;
      } else {
        applyButton.innerHTML = "Apply";
        applyButton.disabled = true;
        setPath(e.data);
      }
      workerBusy = false;
    };
    worker.onerror = function(e) {
      console.log("worker error", e);
    };
    workerBusy = false;
  }
  setupWorker();

  var testCode = function(){
    if (worker && !workerBusy) {
      workerBusy = true;
      applyButton.innerHTML = "Working... cancel?";
      applyButton.disabled = false;
      testCodeStart = Date.now();
      testingCode = editor.getValue();
      worker.postMessage(testingCode);      
    } else {
      // ?
    }
  };
  testCode();

  applyButton.onclick = function(){
    // Restart
    if (worker && workerBusy) {
      worker.terminate();
      setupWorker();
      applyButton.innerHTML = "Apply";
      applyButton.disabled = true;
    }
  };

  session.on("change", function (e) {
    if(changeTimeout) {
      clearTimeout(changeTimeout);
    }
    changeTimeout = setTimeout(testCode, 500);
  });

  var setPath = function(d){
    path.setAttributeNS(null, "d", d);

    var bBox = path.getBBox();
    var w = Math.max(500, Math.ceil(bBox.x+bBox.width+20));
    var h = Math.max(500, Math.ceil(bBox.y+bBox.height+20));
    svg.setAttribute("width", w);
    svg.setAttribute("height", h);
  };


  var helpShown = false;
  helpButton.onclick = function(){
    helpShown = !helpShown;
    help.style.display = helpShown ? "block" : "none";
  };

  exportButton.onclick = function(){
    var svgText = document.getElementById("svgContainer").innerHTML;
    window.open("data:image/svg+xml,"+svgText);
  }


}
</script>
</body>
</html>